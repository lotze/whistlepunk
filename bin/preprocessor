#!/usr/bin/env ../node_modules/.bin/coffee

Dispatcher = require '../lib/dispatcher'
BacklogProcessor = require '../lib/backlog_filler'
BacklogProcessor = require '../lib/backlog_processor'
Filter = require '../lib/filter'
FilterStream = require '../lib/filter_stream'

dispatcher        = new Dispatcher(redis_builder('distillery'))
backlogFiller     = new BacklogFiller(redis_builder('whistlepunk'))
filter            = new Filter(redis_builder('whistlepunk'), [javascriptEnabledValidator, loggedInValidator, userAgentValidator])
backlogProcessor  = new BacklogProcessor(redis_builder('filtered'), 1000 * 60 * 60, filter) # pull from some config somewhere

whistlePunkStream = new RedisListWriter(redis_builder('whistlepunk')) #turns into good_stream & bad_stream

dispatcher.pipe(backlogFiller)
dispatcher.pipe(filter)
dispatcher.pipe(backlogProcessor)
